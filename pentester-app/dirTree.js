/* eslint-env node */

import dirTree from 'directory-tree'
import { flatten } from 'flat'
import fs from 'fs'

if (process.argv[2] !== undefined) {
  const tree = dirTree(process.argv[2])

  const filelist = flatten(tree)
  let content = []

  for (const [key, value] of Object.entries(filelist)) {
    if (
      key.indexOf('.path') === key.length - 5 &&
      value.toLowerCase().indexOf('node_modules') < 0 &&
      value.toLowerCase().indexOf('.git') < 0
    ) {
      try {
        if (!fs.lstatSync(value).isDirectory()) {
          content.push(value.replace(process.argv[2], ''))
        }
      } catch {
        console.log('ERROR: unable to lstatSync', value)
      }
    }
  }

  // const content = JSON.stringify(tree)

  fs.writeFile('./src/assets/dirtree.json', JSON.stringify(content), (err) => {
    if (err) {
      console.error(err)
    }
    console.log('successfully saved to ./src/assets/dirtree.json')
  })
}
