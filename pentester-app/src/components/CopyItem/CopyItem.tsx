import ContentCopyIcon from '@mui/icons-material/ContentCopy'
import { Box, IconButton } from '@mui/material'
import { useSignal, useSignalEffect } from '@preact/signals-react'
import { useCallback } from 'react'
import SuccessTooltip from '../SuccessTooltip'

interface Props {
  children?: React.ReactNode
  val: string
}

function CopyItem({ children, val }: Props) {
  const tooltipOpen = useSignal(false)

  const handleTooltipClose = useCallback(() => {
    tooltipOpen.value = false
  }, [tooltipOpen])

  useSignalEffect(() => {
    if (tooltipOpen.value === false) {
      return
    }
    const timer1 = setTimeout(() => {
      tooltipOpen.value = false
    }, 1000)

    return () => {
      clearTimeout(timer1)
    }
  })

  return (
    <Box sx={{ display: 'flex', alignItems: 'center', alignContent: 'center' }}>
      <SuccessTooltip
        PopperProps={{
          disablePortal: true,
        }}
        onClose={handleTooltipClose}
        open={tooltipOpen.value}
        disableFocusListener
        disableHoverListener
        disableTouchListener
        title="Copied!"
      >
        <IconButton
          onClick={() => {
            tooltipOpen.value = true
            navigator.clipboard.writeText(val)
          }}
        >
          <ContentCopyIcon />
        </IconButton>
      </SuccessTooltip>
      {children}
    </Box>
  )
}

export default CopyItem
