import { useContext } from 'react'
import { Box, Grid, List, Typography } from '@mui/material'

import React from 'react'
import { AppState } from '../../Home'
import CommandTools from './components/CommandTools'
import DownloadFiles from './components/DownloadFiles'
import TerminalWrap from './components/TerminalWrap'
import CommandOptions from './components/CommandOptions'
import CommandText from './components/CommandText'
import ProxyChains from './components/ProxyChains'

const CommandConfigurator = React.memo(() => {
  const { command_windows, commandSearch } = useContext(AppState)

  const Windows = React.memo(() => {
    if (
      command_windows.value === undefined ||
      command_windows.value.length < 1
    ) {
      return <></>
    }

    return command_windows.value.map((cwin, cwinIndex) => {
      const WindowTools = React.memo(() => {
        return (
          <React.Fragment key={`win-${cwin.win}-tools`}>
            <List sx={{ background: '#1e1e1e' }}>
              <DownloadFiles windowNum={cwin.win} />

              <CommandTools windowNum={cwin.win} />

              <Box>
                <hr style={{ width: '50%', border: '1px solid #444' }} />
                {cwin.allowTerminalWrap === true && (
                  <TerminalWrap windowNum={cwin.win} />
                )}
                {cwin.allowProxychains && <ProxyChains windowNum={cwin.win} />}
              </Box>
            </List>
          </React.Fragment>
        )
      })

      if (cwin === undefined || cwin?.win === undefined) {
        return (
          <React.Fragment key={`cwin-undefined-${cwinIndex}`}></React.Fragment>
        )
      }

      return (
        <React.Fragment key={`windows-${cwin.win}-all`}>
          <CommandText windowNum={cwin.win} />

          <WindowTools />
        </React.Fragment>
      )
    })
  })

  return (
    <>
      {commandSearch.value.length > 0 ? (
        <Grid container>
          <Grid item xs={3}>
            <List dense>
              <CommandOptions />
            </List>
          </Grid>
          <Grid item xs={9}>
            <Box id="windows-box">
              <Windows />
            </Box>
          </Grid>
        </Grid>
      ) : (
        <Box sx={{ padding: '15px' }}>
          <Typography
            variant="h5"
            sx={{
              textAlign: 'center',
              color: '#444',
              marginTop: '40px',
              userSelect: 'none',
            }}
          >
            Welcome! Use the Command Search to get started
          </Typography>
        </Box>
      )}
    </>
  )
})

export default CommandConfigurator
