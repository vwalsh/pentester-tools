import { useContext } from 'react'
import { Box, Grid, List } from '@mui/material'

import React from 'react'
import { AppState } from '../../Home'
import CommandTools from './components/CommandTools'
import DownloadFiles from './components/DownloadFiles'
import TerminalWrap from './components/TerminalWrap'
import CommandOptions from './components/CommandOptions'
import CommandText from './components/CommandText'
import ProxyChains from './components/ProxyChains'

// interface ReactChildren {
//   children?: React.ReactNode
// }

const CommandConfigurator = React.memo(() => {
  const { command_windows } = useContext(AppState)

  const Windows = React.memo(() => {
    if (
      command_windows.value === undefined ||
      command_windows.value.length < 1
    ) {
      return <></>
    }

    return command_windows.value.map((cwin, cwinIndex) => {
      const WindowTools = React.memo(() => {
        return (
          <React.Fragment key={`win-${cwin.win}-tools`}>
            <List>
              <DownloadFiles windowNum={cwin.win} />
              <CommandTools windowNum={cwin.win} />

              <Grid container>
                <Grid item xs={6}>
                  {cwin.allowTerminalWrap === true && (
                    <TerminalWrap windowNum={cwin.win} />
                  )}
                </Grid>
                <Grid item xs={6}></Grid>

                <Grid item xs={12}>
                  {cwin.allowProxychains && (
                    <ProxyChains windowNum={cwin.win} />
                  )}
                </Grid>
              </Grid>

              <hr />
            </List>
          </React.Fragment>
        )
      })

      if (cwin === undefined || cwin?.win === undefined) {
        return (
          <React.Fragment key={`cwin-undefined-${cwinIndex}`}></React.Fragment>
        )
      }

      return (
        <React.Fragment key={`windows-${cwin.win}-all`}>
          {/* <CommandText cwin={cwin} /> */}
          <CommandText windowNum={cwin.win} />

          <WindowTools />
        </React.Fragment>
      )
    })
  })

  return (
    <>
      <Grid container>
        <Grid item xs={3}>
          <List>
            <CommandOptions command_windows={command_windows} />
          </List>
        </Grid>
        <Grid item xs={9}>
          <Box id="windows-box">
            <Windows />
          </Box>
        </Grid>
      </Grid>
    </>
  )
})

export default CommandConfigurator
