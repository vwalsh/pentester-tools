import { Autocomplete, Box, Typography } from '@mui/material'
import TextField from '@mui/material/TextField'
import { useContext } from 'react'
import AlertDialog from '../../../../components/AlertDialog'
import { AppState } from '../../Home'

import Commands from '../../../../assets/commands.json'
import { CommandsProps } from '../ConfigInput/ConfigInput'

interface TermsProps {
  label: string
}

const search_terms: Array<TermsProps> = (Commands as Array<CommandsProps>).map(
  (cmd): TermsProps => {
    return {
      label: cmd.id.replaceAll('-', ' '),
    }
  }
)

function OmniSearch() {
  const { search } = useContext(AppState)

  return (
    <>
      <Box
        sx={{ display: 'flex', alignContent: 'center', alignItems: 'center' }}
      >
        <AlertDialog title="Search for a command">
          <Typography>
            Fuzzy search is applied, for best results consider a category such
            as 'download' or a protocol like 'http'
          </Typography>
        </AlertDialog>

        <Autocomplete
          freeSolo
          disablePortal
          id="omni-search-box"
          options={search_terms}
          sx={{ width: 300 }}
          renderInput={(params) => (
            <TextField {...params} label="Command Search..." />
          )}
          onChange={(
            _event: React.SyntheticEvent,
            newValue: string | TermsProps | null
          ) => {
            if (newValue === null) {
              search.value = ''
            } else if (typeof newValue === 'string') {
              search.value = newValue
            } else {
              search.value = newValue?.label !== undefined ? newValue.label : ''
            }
          }}
          isOptionEqualToValue={function (
            option: TermsProps,
            value: TermsProps
          ) {
            if (option.label === value.label) {
              return true
            }

            return false
          }}
        />
      </Box>
    </>
  )
}

export default OmniSearch
